From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Martin Wilck <mwilck@suse.com>
Date: Fri, 18 Dec 2020 23:21:16 +0100
Subject: [PATCH] github workflow: add valgrind tests

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
---
 .github/workflows/build-and-unittest.yaml | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/.github/workflows/build-and-unittest.yaml b/.github/workflows/build-and-unittest.yaml
index 577a14ac..929f63a6 100644
--- a/.github/workflows/build-and-unittest.yaml
+++ b/.github/workflows/build-and-unittest.yaml
@@ -16,13 +16,17 @@ jobs:
       - name: dependencies
         run: >
           sudo apt-get install --yes gcc
-          make perl-base pkg-config
+          make perl-base pkg-config valgrind
           libdevmapper-dev libreadline-dev libaio-dev libsystemd-dev
           libudev-dev libjson-c-dev liburcu-dev libcmocka-dev
       - name: build
         run: make -O -j$(grep -c ^processor /proc/cpuinfo)
       - name: test
         run: make -O -j$(grep -c ^processor /proc/cpuinfo) test
+      - name: valgrind-test
+        run: make -O -j$(grep -c ^processor /proc/cpuinfo) valgrind-test
+      - name: valgrind-results
+        run: cat tests/*.vgr
       - name: clean-nonroot-artifacts
         run: rm -f tests/dmevents.out tests/directio.out
       - name: root-test
